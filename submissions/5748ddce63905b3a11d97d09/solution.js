var chars=".abcdefghijklmnopqrstuvwxyz'",dictLen=chars.length,dict={},nn,noChar=zeros(dictLen);chars.split("").map(function(a,b){var c=zeros(dictLen);c[b]=1;dict[a]=c});function w2vec(a){return(a+".").split("").map(function(a){return dict[a]})}var model;
module.exports={init:function(a){function b(b,c){for(var f=Array(b),g=0;g<b;g++){for(var l=Array(c),m=0;m<c;m++)l[m]=a.readFloatLE(d),d+=4;f[g]=l}return f}function c(){return{W:b(dictLen,62),U:b(62,62),b:b(1,62)}}var d=0;model={gru:{z:c(),r:c(),h:c()},dense:{W:b(62,1),b:b(1,1)}}},test:function(a){var b=a.length;if(30<b)return!1;16<b&&(a=a.substr(0,16),wlen=16);b=w2vec(a);a=a.length;for(var c,d={},e=0;16>e;e++)c=gru(e<a?[b[e]]:[noChar],d);return.5<sigmoid(sum(dot(c,model.dense.W),model.dense.b))}};
function gru(a,b){b.h_tm1||(b.h_tm1=[zeros(model.gru.h.U.length)]);var c=b.h_tm1,d=sum(dot(a,model.gru.z.W),model.gru.z.b),e=sum(dot(a,model.gru.r.W),model.gru.r.b),k=sum(dot(a,model.gru.h.W),model.gru.h.b),d=hardSigmoid(sum(d,dot(c,model.gru.z.U))),e=hardSigmoid(sum(e,dot(c,model.gru.r.U))),k=tanh(sum(k,dot(mul1d(e,c),model.gru.h.U)));h=sum(mul1d(d,c),mul1d(sub(1,d),k));return b.h_tm1=h}function mul1d(a,b){return a.map(function(a,d){return a.map(function(a,c){return a*b[d][c]})})}
function sum(a,b){return a[0].length?a.map(function(a,d){return sum(a,b[d])}):a.map(function(a,d){return a+b[d]})}function sub(a,b){return a.length?a[0].length?a.map(function(a,d){return sub(a,b[d])}):a.map(function(a,d){return a-b[d]}):b[0].length?b.map(function(b){return sub(a,b)}):b.map(function(b){return a-b})}function dot(a,b){for(var c=a.length,d=b[0].length,e=a[0].length,k=Array(c),f=0;f<c;f++){k[f]=zeros(d);for(var g=0;g<d;g++)for(var l=0;l<e;l++)k[f][g]+=a[f][l]*b[l][g]}return k}
function hardSigmoid(a){return a.map?a.map(hardSigmoid):Math.max(0,Math.min(1,.2*a+.5))}function sigmoid(a){return 1/(1+Math.exp(-a))}function tanh(a){if(a.map)return a.map(tanh);a=Math.exp(a);var b=1/a;return(a-b)/(a+b)}function zeros(a){return Array(a+1).join("0").split("").map(parseFloat)};